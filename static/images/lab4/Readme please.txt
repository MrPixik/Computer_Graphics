Я немного ошибся, когда читал условие работы и сделал обрезание для кривых, а не прямых.
К сожалению, я понял, это слишком поздно. Надеюсь, что это ни на что не повлияет, так как
обрезание все равно происходит для аппроксимации маленьких участков прямых.